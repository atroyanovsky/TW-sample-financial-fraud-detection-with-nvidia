apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ngc-registry-secret
  namespace: team-1
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: ngc-registry-secret
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: |
          {
            "auths": {
              "nvcr.io": {
                "username": "$oauthtoken",
                "password": "{{ .ngcApiKey }}",
                "auth": "{{ printf "$oauthtoken:%s" .ngcApiKey | b64enc }}"
              }
            }
          }
  data:
  - secretKey: ngcApiKey
    remoteRef:
      key: {{ .Values.ngc.secretName | default "ngc-api-key" }}
      property: {{ .Values.ngc.secretProperty | default "api-key" }}
